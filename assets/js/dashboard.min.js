!function(e){"use strict";e(document).ready(function(){function t(){var t=e(".we-submission-checkbox:checked").length,s=e(".we-bulk-actions"),i=e(".we-selected-count");t>0?(s.show(),i.text(t+" "+weSpamfighter.strings.selectedCount)):(s.hide(),i.text(""))}e(".we-move-to-normal").on("click",function(){var s=e(this),i=s.data("submission-id"),r=s.closest("tr");confirm(weSpamfighter.strings.confirmMove)&&(s.prop("disabled",!0).text(weSpamfighter.strings.moving),e.ajax({url:weSpamfighter.ajax_url,type:"POST",data:{action:"we_spamfighter_move_to_normal",nonce:weSpamfighter.nonce,submission_id:i},success:function(e){e.success?(r.fadeOut(300,function(){r.remove(),t()}),alert(e.data.message),location.reload()):(alert(weSpamfighter.strings.error+": "+e.data.message),s.prop("disabled",!1).text(weSpamfighter.strings.moveToNormal))},error:function(){alert(weSpamfighter.strings.errorOccurred),s.prop("disabled",!1).text(weSpamfighter.strings.moveToNormal)}}))}),e(".we-view-details").on("click",function(){var t=e(this),s=t.data("submission-id"),i=e("#we-submission-details-modal"),r=e("#we-submission-details-content");t.prop("disabled",!0).text(weSpamfighter.strings.loading),e.ajax({url:weSpamfighter.ajax_url,type:"POST",data:{action:"we_spamfighter_get_submission_details",nonce:weSpamfighter.nonce,submission_id:s},success:function(e){if(t.prop("disabled",!1).text(weSpamfighter.strings.viewDetails),e.success){var s=e.data;function o(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return String(e).replace(/[&<>"']/g,function(e){return t[e]})}var a="<h2>Submission Details</h2>";a+="<p><strong>ID:</strong> "+o(s.id)+"</p>",a+="<p><strong>Type:</strong> "+o(s.submission_type)+"</p>",a+="<p><strong>Form/Post ID:</strong> "+o(s.form_id)+"</p>",a+="<p><strong>Is Spam:</strong> "+(1==s.is_spam?"Yes":"No")+"</p>",a+="<p><strong>Spam Score:</strong> "+o(parseFloat(s.spam_score).toFixed(2))+"</p>",a+="<p><strong>Created:</strong> "+o(s.created_at)+"</p>",s.submission_data&&(a+="<h3>Submission Data</h3>",a+="<pre>"+o(JSON.stringify(s.submission_data,null,2))+"</pre>"),s.detection_details&&(a+="<h3>Detection Details</h3>",a+="<pre>"+o(JSON.stringify(s.detection_details,null,2))+"</pre>"),r.html(a),i.fadeIn(300)}else alert(weSpamfighter.strings.error+": "+e.data.message)},error:function(){t.prop("disabled",!1).text(weSpamfighter.strings.viewDetails),alert(weSpamfighter.strings.errorOccurred)}})}),e(".we-modal-close").on("click",function(){e("#we-submission-details-modal").fadeOut(300)}),e(window).on("click",function(t){var s=e("#we-submission-details-modal");e(t.target).is(s)&&s.fadeOut(300)}),e(".we-move-to-spam").on("click",function(){var s=e(this),i=s.data("submission-id"),r=s.closest("tr");confirm(weSpamfighter.strings.confirmMoveToSpam)&&(s.prop("disabled",!0).text(weSpamfighter.strings.moving),e.ajax({url:weSpamfighter.ajax_url,type:"POST",data:{action:"we_spamfighter_move_to_spam",nonce:weSpamfighter.nonce,submission_id:i},success:function(e){e.success?(r.fadeOut(300,function(){r.remove(),t()}),alert(e.data.message),location.reload()):(alert(weSpamfighter.strings.error+": "+e.data.message),s.prop("disabled",!1).text(weSpamfighter.strings.moveToSpam))},error:function(){alert(weSpamfighter.strings.errorOccurred),s.prop("disabled",!1).text(weSpamfighter.strings.moveToSpam)}}))}),e(document).on("click",".we-delete-submission",function(){var s=e(this),i=s.data("submission-id"),r=s.closest("tr");confirm(weSpamfighter.strings.confirmDelete)&&(s.prop("disabled",!0).text(weSpamfighter.strings.deleting),e.ajax({url:weSpamfighter.ajax_url,type:"POST",data:{action:"we_spamfighter_delete_submission",nonce:weSpamfighter.nonce,submission_id:i},success:function(e){e.success?(r.fadeOut(300,function(){r.remove(),t()}),alert(e.data.message),location.reload()):(alert(weSpamfighter.strings.error+": "+e.data.message),s.prop("disabled",!1).text(weSpamfighter.strings.delete))},error:function(){alert(weSpamfighter.strings.errorOccurred),s.prop("disabled",!1).text(weSpamfighter.strings.delete)}}))}),e("#we-select-all").on("change",function(){var s=e(this).prop("checked");e(".we-submission-checkbox").prop("checked",s),t()}),e(document).on("change",".we-submission-checkbox",function(){var s,i;t(),s=e(".we-submission-checkbox").length,i=e(".we-submission-checkbox:checked").length,e("#we-select-all").prop("checked",s>0&&i===s)}),e(".we-bulk-action-apply").on("click",function(){var s=e("#we-bulk-action-select").val(),i=e(".we-submission-checkbox:checked");if(s)if(0!==i.length){var r=[];if(i.each(function(){r.push(e(this).val())}),"delete"===s){if(!confirm(weSpamfighter.strings.confirmBulkDelete))return;var a=e(this);a.prop("disabled",!0).text(weSpamfighter.strings.deleting),e.ajax({url:weSpamfighter.ajax_url,type:"POST",data:{action:"we_spamfighter_bulk_delete_submissions",nonce:weSpamfighter.nonce,submission_ids:r},success:function(s){a.prop("disabled",!1).text(weSpamfighter.strings.apply),s.success?(i.each(function(){e(this).closest("tr").fadeOut(300,function(){e(this).remove()})}),alert(s.data.message),t(),location.reload()):alert(weSpamfighter.strings.error+": "+s.data.message)},error:function(){a.prop("disabled",!1).text(weSpamfighter.strings.apply),alert(weSpamfighter.strings.errorOccurred)}})}}else alert(weSpamfighter.strings.selectItems);else alert(weSpamfighter.strings.selectItems)})})}(jQuery);